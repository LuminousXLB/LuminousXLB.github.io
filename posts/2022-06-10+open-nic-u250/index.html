<!doctype html><html lang=en dir=ltr><meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<title>Try OpenNIC on U250 | SHEN Jiamin's Home</title>
<meta name=generator content="Hugo Eureka 0.9.3">
<link rel=stylesheet href=/css/eureka.min.99d8446bcce64364c7d4dc0005635dc845a72b3c30cc16e14833073b177c394e207f1de9edd90c257504506a5f3e5c6b.css>
<script defer src=/js/eureka.min.4ab4e11bfa71ae0aeed55e31bbb0f8ab16c24a648722270637c4b96ea70eef4ddf17aa3e2a8131f613520e0387c1bbde.js></script>
<link rel=preconnect href=https://fonts.googleapis.com>
<link rel=preconnect href=https://fonts.gstatic.com crossorigin>
<link rel=preload href="https://fonts.googleapis.com/css2?family=Lora:wght@400;600;700&family=Noto+Serif+SC:wght@400;600;700&display=swap" as=style onload="this.onload=null,this.rel='stylesheet'">
<link rel=stylesheet href=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/styles/base16/solarized-light.min.css media=print onload="this.media='all',this.onload=null" crossorigin>
<script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/highlight.min.js crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/dart.min.js crossorigin></script>
<link rel=stylesheet href=/css/highlightjs.min.2958991528e43eb6fc9b8c4f2b8e052f79c4010718e1d1e888a777620e9ee63021c2c57ec7417a3108019bb8c41943e6.css media=print onload="this.media='all',this.onload=null">
<script defer type=text/javascript src=/js/fontawesome.min.ed3f38f9c3ba0fae4dab6767607c4c65f01e88553b6ad80e16748f20494090e182b61a6f6b75bac21282286e21e01009.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css integrity=sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ media=print onload="this.media='all',this.onload=null" crossorigin>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js integrity=sha384-VQ8d8WVFw0yHhCk5E8I86oOhv48xLpnDZx5T9GogA/Y84DcCKWXDmSDfn13bzFZY crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})})</script>
<script defer src=https://cdn.jsdelivr.net/npm/mermaid@8.14.0/dist/mermaid.min.js integrity=sha384-atOyb0FxAgN9LyAc6PEf9BjgwLISyansgdH8/VXQH8p2o5vfrRgmGIJ2Sg22L0A0 crossorigin></script>
<link rel=stylesheet href=/css/print.min.f4e3d805f70a2d75cecee85c103c80aeca745687bcd103b620b896abe64d833367c518461b9c9a3ae5db4f2cb4ac79da.css>
<script defer src=/js/print.min.9c5f366eac54bf19097c1bcda7ad363951ee66fb9c2df6e17ce666dcfdebbf06f0f3a2a2db458ad9ee26896913b997d9.js></script>
<link rel=icon type=image/png sizes=32x32 href=/images/me_huc4289e53193a55938e36bb442bd9f5e1_241001_32x32_fill_box_center_3.png>
<link rel=apple-touch-icon sizes=180x180 href=/images/me_huc4289e53193a55938e36bb442bd9f5e1_241001_180x180_fill_box_center_3.png>
<meta name=description content="Something the readme didn't tell you.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"/posts/"},{"@type":"ListItem","position":2,"name":"Try OpenNIC on U250","item":"/posts/2022-06-10+open-nic-u250/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/2022-06-10+open-nic-u250/"},"headline":"Try OpenNIC on U250 | SHEN Jiamin\u0027s Home","datePublished":"2022-06-10T00:00:00+00:00","dateModified":"2022-06-10T00:00:00+00:00","wordCount":380,"publisher":{"@type":"Person","name":"SHEN Jiamin","logo":{"@type":"ImageObject","url":"/images/me.png"}},"description":"Something the readme didn\u0027t tell you."}</script><meta property="og:title" content="Try OpenNIC on U250 | SHEN Jiamin's Home">
<meta property="og:type" content="article">
<meta property="og:image" content="/images/me.png">
<meta property="og:url" content="/posts/2022-06-10+open-nic-u250/">
<meta property="og:description" content="Something the readme didn't tell you.">
<meta property="og:locale" content="en">
<meta property="og:site_name" content="SHEN Jiamin's Home">
<meta property="article:published_time" content="2022-06-10T00:00:00+00:00">
<meta property="article:modified_time" content="2022-06-10T00:00:00+00:00">
<meta property="article:section" content="posts">
<meta property="article:tag" content="xilinx">
<meta property="article:tag" content="nic">
<body class="flex min-h-screen flex-col">
<header class="min-h-16 pl-scrollbar bg-secondary-bg fixed z-50 flex w-full items-center shadow-sm">
<div class="mx-auto w-full max-w-screen-xl"><script>let storageColorScheme=localStorage.getItem("lightDarkMode");((storageColorScheme=='Auto'||storageColorScheme==null)&&window.matchMedia("(prefers-color-scheme: dark)").matches||storageColorScheme=="Dark")&&document.getElementsByTagName('html')[0].classList.add('dark')</script>
<nav class="flex items-center justify-between flex-wrap px-4 py-4 md:py-0">
<a href=/ class="me-6 text-primary-text text-xl font-bold">SHEN Jiamin's Home</a>
<button id=navbar-btn class="md:hidden flex items-center px-3 py-2" aria-label="Open Navbar">
<i class="fas fa-bars"></i>
</button>
<div id=target class="hidden block md:flex md:grow md:justify-between md:items-center w-full md:w-auto text-primary-text z-20">
<div class="md:flex md:h-16 text-sm md:grow pb-4 md:pb-0 border-b md:border-b-0">
<a href=/#about class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2 border-transparent me-4">About</a>
<a href=/posts/ class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2 selected-menu-item me-4">Posts</a>
</div>
<div class=flex>
<div class="relative pt-4 md:pt-0">
<div class="cursor-pointer hover:text-eureka" id=lightDarkMode>
<i class="fas fa-adjust"></i>
</div>
<div class="fixed hidden inset-0 opacity-0 h-full w-full cursor-default z-30" id=is-open>
</div>
<div class="absolute flex flex-col start-0 md:start-auto end-auto md:end-0 hidden bg-secondary-bg w-48 rounded py-2 border border-tertiary-bg cursor-pointer z-40" id=lightDarkOptions>
<span class="px-4 py-1 hover:text-eureka" name=Light>Light</span>
<span class="px-4 py-1 hover:text-eureka" name=Dark>Dark</span>
<span class="px-4 py-1 hover:text-eureka" name=Auto>Auto</span>
</div>
</div>
</div>
</div>
<div class="fixed hidden inset-0 opacity-0 h-full w-full cursor-default z-0" id=is-open-mobile>
</div>
</nav>
<script>let element=document.getElementById('lightDarkMode');storageColorScheme==null||storageColorScheme=='Auto'?document.addEventListener('DOMContentLoaded',()=>{window.matchMedia("(prefers-color-scheme: dark)").addEventListener('change',switchDarkMode)}):storageColorScheme=="Light"?(element.firstElementChild.classList.remove('fa-adjust'),element.firstElementChild.setAttribute("data-icon",'sun'),element.firstElementChild.classList.add('fa-sun')):storageColorScheme=="Dark"&&(element.firstElementChild.classList.remove('fa-adjust'),element.firstElementChild.setAttribute("data-icon",'moon'),element.firstElementChild.classList.add('fa-moon')),document.addEventListener('DOMContentLoaded',()=>{getcolorscheme(),switchBurger()})</script>
</div>
</header>
<main class="grow pt-16">
<div class=pl-scrollbar>
<div class="mx-auto w-full max-w-screen-xl lg:px-4 xl:px-8">
<div class="grid grid-cols-2 gap-4 lg:grid-cols-8 lg:pt-12">
<div class="bg-secondary-bg col-span-2 rounded px-6 py-8 lg:col-span-6">
<article class=prose>
<h1 class=mb-4>Try OpenNIC on U250</h1>
<div class="text-tertiary-text not-prose mt-2 flex flex-row flex-wrap items-center">
<div class="me-6 my-2">
<i class="fas fa-calendar me-1"></i>
<span>2022-06-10</span>
</div>
<div class="me-6 my-2">
<i class="fas fa-clock me-1"></i>
<span>2 min read</span>
</div>
</div>
<h2 id=overview>Overview</h2>
<p>The <a href=https://github.com/Xilinx/open-nic>AMD OpenNIC Project</a> consists of a
hardware design (OpenNIC shell) and two software drivers (OpenNIC driver and
OpenNIC DPDK).</p>
<p>This article is base on <a href=https://github.com/Xilinx/open-nic-shell/tree/542a487049b454235bc82ebc52d5511a38b8623c>open-nic-shell</a> at commit <code>542a487</code> and <a href=https://github.com/Xilinx/open-nic-driver/tree/2fa96685de279a60a4257c3ac36625275e91ff37>open-nic-driver</a> at commit <code>2fa9668</code>.</p>
<h2 id=tips-on-the-hardware-part>Tips on the Hardware Part</h2>
<p>It&rsquo;s easy to get an FPGA bitstream by following the README.</p>
<p>There are two QSFP28 interfaces on the Alveo U250 Data Center Accelerator Card.
But the shell enables only one of them by default.
Thus, if both of them are needed, do set the parameter <code>-num_cmac_port</code> to 2.
And correspondingly, the <code>-num_phys_func</code> shall be 2 as well.</p>
<h2 id=tips-on-the-driver>Tips on the Driver</h2>
<p>Do note that</p>
<blockquote>
<p>There is an optional parameter <code>RS_FEC_ENABLED</code>, which can be set to either zero or one.</p>
</blockquote>
<p>The feature shall be either both enabled on OpenNIC and its peer, or both disabled.
It is enabled on OpenNIC by default.
And if the connection doesn&rsquo;t work, do try setting the parameter to <code>0</code>.</p>
<pre><code class=language-console>$ sudo insmod onic.ko RS_FEC_ENABLED=0
</code></pre>
<h2 id=tips-on-the-running-iperf3>Tips on the Running <code>iperf3</code></h2>
<p>Do remember to set <code>--bind-dev</code> flag on the OpenNIC side, whether it&rsquo;s server or not, when using <code>iperf3</code> to test the connection.</p>
<h2 id=something-else-you-can-do-to-debug>Something Else You Can Do to Debug</h2>
<p>There are some registers you can read in the <a href=https://github.com/Xilinx/open-nic-shell/blob/542a487049b454235bc82ebc52d5511a38b8623c/src/packet_adapter/packet_adapter_register.v>Packet Adapter</a>.
The offset of two packet adapters are <code>0x0B000</code> and <code>0x0F000</code>.
You can find more information in the comment in <a href=https://github.com/Xilinx/open-nic-shell/blob/542a487049b454235bc82ebc52d5511a38b8623c/src/system_config/system_config_address_map.sv><code>system_config_address_map.sv</code></a>.</p>
<p>To read the registers, <a href=https://github.com/billfarrow/pcimem>pcimem</a> can be helpful.</p>
<pre><code class=language-console>$ sudo ./pcimem /sys/class/net/enp24s0f0/device/resource2 0x0F000 w*20
/sys/class/net/enp24s0f0/device/resource2 opened.
Target offset is 0xf000, page size is 4096
mmap(0, 4096, 0x3, 0x1, 3, 0xf000)
PCI Memory mapped to address 0x7f0dc57f2000.
Value at offset 0xF000 (0x7f0dc57f2000): 0x00723276
Value at offset 0xF004 (0x7f0dc57f2004): 0x00000000
Value at offset 0xF008 (0x7f0dc57f2008): 0xA3515F63
Value at offset 0xF00C (0x7f0dc57f200c): 0x00000002
Value at offset 0xF010 (0x7f0dc57f2010): 0x00000000
Value at offset 0xF014 (0x7f0dc57f2014): 0x00000000
Value at offset 0xF018 (0x7f0dc57f2018): 0x00000000
Value at offset 0xF01C (0x7f0dc57f201c): 0x00000000
Value at offset 0xF020 (0x7f0dc57f2020): 0x00016DDF
Value at offset 0xF024 (0x7f0dc57f2024): 0x00000000
Value at offset 0xF028 (0x7f0dc57f2028): 0x005E5617
Value at offset 0xF02C (0x7f0dc57f202c): 0x00000000
Value at offset 0xF030 (0x7f0dc57f2030): 0x00000000
Value at offset 0xF034 (0x7f0dc57f2034): 0x00000000
Value at offset 0xF038 (0x7f0dc57f2038): 0x00000000
Value at offset 0xF03C (0x7f0dc57f203c): 0x00000000
Value at offset 0xF040 (0x7f0dc57f2040): 0x00000000
Value at offset 0xF044 (0x7f0dc57f2044): 0x00000000
Value at offset 0xF048 (0x7f0dc57f2048): 0x00000000
Value at offset 0xF04C (0x7f0dc57f204c): 0x00000000
</code></pre>
</article>
<div class=my-4>
<a href=/tags/xilinx/ class="inline-block bg-tertiary-bg text-sm rounded px-3 py-1 my-1 me-2 hover:text-eureka">#xilinx</a>
<a href=/tags/nic/ class="inline-block bg-tertiary-bg text-sm rounded px-3 py-1 my-1 me-2 hover:text-eureka">#nic</a>
</div>
<div class="-mx-2 mt-4 flex flex-col border-t px-2 pt-4 md:flex-row md:justify-between">
<div>
<span class="text-primary-text block font-bold">Previous</span>
<a href=/posts/2022-06-19+github-https/ class=block>Use HTTPS? Login to Github Using gh</a>
</div>
<div class="mt-4 md:mt-0 md:text-right">
</div>
</div>
</div>
<div class=col-span-2>
<div class="bg-primary-bg
prose sticky top-16 z-10 hidden px-6 py-4 lg:block">
<h3>On This Page</h3>
</div>
<div class="sticky-toc hidden px-6 pb-6 lg:block">
<nav id=TableOfContents>
<ul>
<li><a href=#overview>Overview</a></li>
<li><a href=#tips-on-the-hardware-part>Tips on the Hardware Part</a></li>
<li><a href=#tips-on-the-driver>Tips on the Driver</a></li>
<li><a href=#tips-on-the-running-iperf3>Tips on the Running <code>iperf3</code></a></li>
<li><a href=#something-else-you-can-do-to-debug>Something Else You Can Do to Debug</a></li>
</ul>
</nav>
</div>
<script>window.addEventListener("DOMContentLoaded",()=>{enableStickyToc()})</script>
</div>
</div>
<script>document.addEventListener("DOMContentLoaded",()=>{hljs.highlightAll()})</script>
</div>
</div>
</main>
<footer class=pl-scrollbar>
<div class="mx-auto w-full max-w-screen-xl"><div class="text-center p-6 pin-b">
<p class="text-sm text-tertiary-text">&copy; 2022 SHEN Jiamin
&#183; Powered by the <a href=https://github.com/wangchucheng/hugo-eureka class=hover:text-eureka>Eureka</a> theme for <a href=https://gohugo.io class=hover:text-eureka>Hugo</a></p>
</div></div>
</footer>
</body>
</html>